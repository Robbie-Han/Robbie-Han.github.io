<h1>数组的迭代方法：</h1>
<div class="field-item even" property="content:encoded"><p>使用数组总是会碰到数组的遍历（迭代）操作。说到迭代，可能会立马想起<code>for</code>语句对数组进行迭代。比如需要迭代出下面数组<code>peoples</code>年龄(<code>age</code>)大于<code>30</code>的人名(<code>name</code>)。</p>

<pre class="cs"><code class="cs"><span class="keyword"><span class="keyword">var</span></span> peoples = [
    {
        name: <span class="string"><span class="string">'Agraj'</span></span>,
        gender:<span class="string"><span class="string">'M'</span></span>,
        age: <span class="number"><span class="number">29</span></span>,
        address:
        {
            city: <span class="string"><span class="string">'Delhi'</span></span>,
            pincode: <span class="string"><span class="string">'110064'</span></span>
        }
    },
    {
        name: <span class="string"><span class="string">'Mark'</span></span>,
        gender:<span class="string"><span class="string">'M'</span></span>,
        age: <span class="number"><span class="number">35</span></span>,
        address:
        {
            city: <span class="string"><span class="string">'West Bengal'</span></span>,
            pincode: <span class="string"><span class="string">'220013'</span></span>
        }
    },
    {
        name: <span class="string"><span class="string">'Lance'</span></span>,
        gender:<span class="string"><span class="string">'M'</span></span>,
        age: <span class="number"><span class="number">39</span></span>,
        address:
        {
            city: <span class="string"><span class="string">'Chandigarh'</span></span>,
            pincode: <span class="string"><span class="string">'201201'</span></span>
        }
    },
    {
        name: <span class="string"><span class="string">'Vikas'</span></span>,
        gender:<span class="string"><span class="string">'M'</span></span>,
        age: <span class="number"><span class="number">21</span></span>,
        address:
        {
            city: <span class="string"><span class="string">'Noida'</span></span>,
            pincode: <span class="string"><span class="string">'201301'</span></span>
        }
    },
    {
        name: <span class="string"><span class="string">'Kanika'</span></span>,
        gender:<span class="string"><span class="string">'F'</span></span>,
        age: <span class="number"><span class="number">21</span></span>,
        address:
        {
            city: <span class="string"><span class="string">'Noida'</span></span>,
            pincode: <span class="string"><span class="string">'201301'</span></span>
        }
    }
];

<span class="keyword"><span class="keyword">for</span></span> (<span class="keyword"><span class="keyword">var</span></span> i = <span class="number"><span class="number">0</span></span>; i &lt; peoples.length; i++ ) {
    <span class="keyword"><span class="keyword">if</span></span> (peoples[i].age &gt; <span class="number"><span class="number">30</span></span>) {
        console.log(peoples[i].name + <span class="string"><span class="string">':'</span></span> + peoples[i].age);
    }
}
</code></pre>

<p>Chrome浏览器输出的结果：</p>

<pre class="css"><code class="css"><span class="tag"><span class="tag">Mark</span></span><span class="pseudo"><span class="pseudo">:35</span></span>
<span class="tag"><span class="tag">Lance</span></span><span class="pseudo"><span class="pseudo">:39</span></span>
</code></pre>

<p>其实ES5为数组定义了五个迭代方法：</p>

<ul>
<li><strong><code>forEach()</code></strong>：没有返回值，只是针对每个数组项调用指定的函数(<code>callbackfn</code>)</li>
<li><strong><code>every()</code></strong>: 返回一个布尔值(<code>true</code>或<code>false</code>)，判断每个数组项是否符合指定函数的条件，符合为<code>true</code>，反之为<code>false</code></li>
<li><strong><code>some()</code></strong>: 返回一个布尔值(<code>true</code>或false),判断每个数组项是否符合指定函数的条件，只要有任何一项返回为<code>true</code>，就会返回<code>true</code></li>
<li><strong><code>filter()</code></strong>: 每个数组项调用指定的函数，条件为<code>true</code>的将返到一个新数组中</li>
<li><strong><code>map()</code></strong>: 每个数组项调用指定的函数，返回每次函数调用的结果组成一个新数组</li>
</ul>

<p>这五个数组迭代的方法中，其中<code>forEach()</code>、<code>every()</code>和<code>some()</code>方法不生成一个新数组，而<code>filter()</code>和<code>map()</code>方法将会生成一个新数组（符合条件）。并且这些方法都会调用指定的函数<code>callbackfn</code>。回调函数<code>callbackfn</code>语法如下：</p>

<pre class="javascript"><code class="javascript"><span class="function"><span class="keyword"><span class="function"><span class="keyword">function</span></span></span><span class="function"> <span class="title"><span class="title">callbackfn</span></span> <span class="params"><span class="params">(value, index, array)</span></span> {</span></span>...}
</code></pre>

<p>可以使用三个参数来声明回调函数<code>callbackfn</code>:</p>

<ul>
<li><strong><code>value</code></strong>: 数组元素的值</li>
<li><strong><code>index</code></strong>: 数组元素在数组中的索引值</li>
<li><strong><code>array</code></strong>: 包含该元素的数组对象</li>
</ul>

<p>今天主要一起了解这五个数组迭代方法是如何使用？在接下来的内容中都将以开头的数组为例。</p>

<h2><code>forEach()</code>方法</h2>

<p><code>forEach()</code> 方法让数组的每一项都执行一次给定的函数。</p>

<h3>语法</h3>

<pre class="php"><code class="php"><span class="keyword"><span class="keyword">array</span></span>.<span class="keyword"><span class="keyword">forEach</span></span>(callbackfn[, thisArg])
</code></pre>

<h3>参数</h3>

<table>
<thead>
<tr>
  <th>参数</th>
  <th>说明</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>array</code></td>
  <td>必选。一个数组对象。比如示例中的<code>peoples</code>数组</td>
</tr>
<tr>
  <td><code>callbackfn</code></td>
  <td>必选。最多可以接受三个参数的函数。对于数组中的每个元素，<code>forEach</code> 都会调用 <code>callbackfn</code> 函数一次。</td>
</tr>
<tr>
  <td><code>thisArg</code></td>
  <td>可选。 <code>callbackfn</code> 函数中的 <code>this</code> 关键字可引用的对象。如果省略 <code>thisArg</code>，则 <code>undefined</code> 将用作 <code>this</code> 值。</td>
</tr>
</tbody>
</table>

<p><code>forEach()</code> 方法按升序为数组中含有效值的每一项执行一次<code>callbackfn</code> 函数，那些已删除或者从未赋值的项将被跳过（但不包括哪些值为 <code>undefined</code> 的项）。</p>

<h3>示例</h3>

<p>开头使用<code>for</code>语句遍历出年龄大于<code>30</code>岁的名称，并且输出<code>people</code>的<code>name</code>和<code>age</code>。其实使用<code>forEach()</code>方法也可以实现：</p>

<pre class="php"><code class="php">peoples.<span class="keyword"><span class="keyword">forEach</span></span>(<span class="function"><span class="keyword"><span class="function"><span class="keyword">function</span></span></span><span class="function"> <span class="params"><span class="params">(people)</span></span> {</span></span>
    <span class="keyword"><span class="keyword">if</span></span> (people.age &gt; <span class="number"><span class="number">30</span></span>) {
        console.log(people.name + <span class="string"><span class="string">':'</span></span> + people.age);
    }
});
</code></pre>

<p>Chrome浏览器输出的结果：</p>

<pre class="css"><code class="css"><span class="tag"><span class="tag">Mark</span></span><span class="pseudo"><span class="pseudo">:35</span></span>
<span class="tag"><span class="tag">Lance</span></span><span class="pseudo"><span class="pseudo">:39</span></span>
</code></pre>

<p>在此基础上，你可以做很多事情，比如说，将数组<code>peoples</code>中的<code>name</code>遍历出来，然后重新创建一个新数组<code>names</code>，可以这样做：</p>

<pre class="php"><code class="php"><span class="keyword"><span class="keyword">var</span></span> names = [];
<span class="keyword"><span class="keyword">var</span></span> peoplesDb = peoples.<span class="keyword"><span class="keyword">forEach</span></span>(<span class="function"><span class="keyword"><span class="function"><span class="keyword">function</span></span></span><span class="function"> <span class="params"><span class="params">(people, index)</span></span> {</span></span>
    names.push(people.name);
});
console.log(names); <span class="comment"><span class="comment">// ["Agraj", "Mark", "Lance", "Vikas", "Kanika"]</span></span>
</code></pre>

<h3>内部实现</h3>

<p>看看<code>forEach()</code>方法内部实现的方法：</p>

<pre class="javascript"><code class="javascript">Array.prototype.forEach = <span class="keyword"><span class="keyword">function</span></span>(fun <span class="comment"><span class="comment">/*, thisp*/</span></span>) {
    <span class="keyword"><span class="keyword">var</span></span> len = <span class="keyword"><span class="keyword">this</span></span>.length;
    <span class="keyword"><span class="keyword">if</span></span> (<span class="keyword"><span class="keyword">typeof</span></span> fun != <span class="string"><span class="string">"function"</span></span>)
        <span class="keyword"><span class="keyword">throw</span></span> <span class="keyword"><span class="keyword">new</span></span> TypeError();

    <span class="keyword"><span class="keyword">var</span></span> thisp = arguments[<span class="number"><span class="number">1</span></span>];
    <span class="keyword"><span class="keyword">for</span></span> (<span class="keyword"><span class="keyword">var</span></span> i = <span class="number"><span class="number">0</span></span>; i &lt; len; i++)
    {
        <span class="keyword"><span class="keyword">if</span></span> (i <span class="keyword"><span class="keyword">in</span></span> <span class="keyword"><span class="keyword">this</span></span>)
        fun.call(thisp, <span class="keyword"><span class="keyword">this</span></span>[i], i, <span class="keyword"><span class="keyword">this</span></span>);
    }
};
</code></pre>

<h2><code>every()</code>方法</h2>

<p><code>every()</code> 方法测试数组的所有元素是否都符合指定函数的条件，只要有有一个元素不符合，返回的都会是<code>false</code>。</p>

<h3>语法</h3>

<pre class="css"><code class="css"><span class="tag"><span class="tag">array</span></span><span class="class"><span class="class">.every</span></span>(<span class="tag"><span class="tag">callbackfn</span></span><span class="attr_selector"><span class="attr_selector">[, thisArg]</span></span>)
</code></pre>

<p><code>every()</code>方法为数组中的每个元素执行一次 <code>callbackfn</code> 函数，直到它找到一个使 <code>callbackfn</code> 返回 <code>false</code>（表示可转换为布尔值 <code>false</code> 的值）的元素。如果发现了一个这样的元素，<code>every()</code> 方法将会立即返回 <code>false</code>。否则，<code>callbackfn</code> 为每一个元素返回 <code>true</code>，<code>every()</code> 就会返回 <code>true</code>。<code>callbackfn</code> 只会为那些已经被赋值的索引调用。不会为那些被删除或从来没被赋值的索引调用。</p>

<h3>示例</h3>

<p>还是上面开头的数组，如果每一位的年龄都大于或等于<code>30</code>,就会返回“都大于或等于30岁了”,反之返回“不是所有人都大于30岁了”。</p>

<pre class="javascript"><code class="javascript"><span class="function"><span class="keyword"><span class="function"><span class="keyword">function</span></span></span><span class="function"> <span class="title"><span class="title">bigAge</span></span><span class="params"><span class="params">(ele,index,arr)</span></span>{</span></span>
    <span class="keyword"><span class="keyword">return</span></span> (ele.age &gt;= <span class="number"><span class="number">30</span></span>);
}

<span class="keyword"><span class="keyword">var</span></span> isBigPeople = peoples.every(bigAge);

<span class="keyword"><span class="keyword">if</span></span> (isBigPeople) {
    console.log(<span class="string"><span class="string">'都大于或等于30岁了'</span></span>);
} <span class="keyword"><span class="keyword">else</span></span> {
    console.log(<span class="string"><span class="string">'不是所有人都大于30岁了'</span></span>);
}
</code></pre>

<p>Chrome浏览器输出的结果：</p>

<pre class="cs"><code class="cs"><span class="comment"><span class="comment">// 不是所有人都大于30岁了</span></span>
</code></pre>

<h3>内部实现</h3>

<pre class="javascript"><code class="javascript">Array.prototype.every = <span class="keyword"><span class="keyword">function</span></span>(fun <span class="comment"><span class="comment">/*, thisp*/</span></span>) {
    <span class="keyword"><span class="keyword">var</span></span> len = <span class="keyword"><span class="keyword">this</span></span>.length;
    <span class="keyword"><span class="keyword">if</span></span> (<span class="keyword"><span class="keyword">typeof</span></span> fun != <span class="string"><span class="string">"function"</span></span>)
        <span class="keyword"><span class="keyword">throw</span></span> <span class="keyword"><span class="keyword">new</span></span> TypeError();

    <span class="keyword"><span class="keyword">var</span></span> thisp = arguments[<span class="number"><span class="number">1</span></span>];
    <span class="keyword"><span class="keyword">for</span></span> (<span class="keyword"><span class="keyword">var</span></span> i = <span class="number"><span class="number">0</span></span>; i &lt; len; i++)
    {
        <span class="keyword"><span class="keyword">if</span></span> (i <span class="keyword"><span class="keyword">in</span></span> <span class="keyword"><span class="keyword">this</span></span> &amp;&amp; !fun.call(thisp, <span class="keyword"><span class="keyword">this</span></span>[i], i, <span class="keyword"><span class="keyword">this</span></span>))
        <span class="keyword"><span class="keyword">return</span></span> <span class="literal"><span class="literal">false</span></span>;
    }
    
    <span class="keyword"><span class="keyword">return</span></span> <span class="literal"><span class="literal">true</span></span>;
};
</code></pre>

<h2><code>some()</code>方法</h2>

<p><code>some()</code>方法和<code>every()</code>方法类似，不同的是，<code>some()</code>方法在调用指定的函数<code>callbackfn</code>指定的条件符合就会返回<code>true</code>，不符合则返回<code>false</code>。</p>

<h3>语法</h3>

<pre class="css"><code class="css"><span class="tag"><span class="tag">array</span></span><span class="class"><span class="class">.some</span></span>(<span class="tag"><span class="tag">callbackfn</span></span><span class="attr_selector"><span class="attr_selector">[, thisArg]</span></span>)
</code></pre>

<h3>示例</h3>

<p>只要数组中年龄<code>age</code>有一个大于或等于<code>30</code>，就会返回“有部分人还是年纪大了”，反之返回“你们都还很年轻”:</p>

<pre class="javascript"><code class="javascript"><span class="function"><span class="keyword"><span class="function"><span class="keyword">function</span></span></span><span class="function"> <span class="title"><span class="title">OldAge</span></span><span class="params"><span class="params">(ele,index,array)</span></span>{</span></span>
    <span class="keyword"><span class="keyword">return</span></span> (ele.age &gt;= <span class="number"><span class="number">30</span></span>);
}

<span class="keyword"><span class="keyword">var</span></span> isOldPeople = peoples.some(OldAge);

<span class="keyword"><span class="keyword">if</span></span> (isOldPeople) {
    console.log(<span class="string"><span class="string">'有部分人还是年纪大了'</span></span>);
} <span class="keyword"><span class="keyword">else</span></span> {
    console.log(<span class="string"><span class="string">'你们都还年轻'</span></span>);
}
</code></pre>

<h3>内部实现</h3>

<pre class="javascript"><code class="javascript">Array.prototype.some = <span class="keyword"><span class="keyword">function</span></span>(fun <span class="comment"><span class="comment">/*, thisp*/</span></span>) {
    <span class="keyword"><span class="keyword">var</span></span> len = <span class="keyword"><span class="keyword">this</span></span>.length;
    <span class="keyword"><span class="keyword">if</span></span> (<span class="keyword"><span class="keyword">typeof</span></span> fun != <span class="string"><span class="string">"function"</span></span>)
        <span class="keyword"><span class="keyword">throw</span></span> <span class="keyword"><span class="keyword">new</span></span> TypeError();

    <span class="keyword"><span class="keyword">var</span></span> thisp = arguments[<span class="number"><span class="number">1</span></span>];
    <span class="keyword"><span class="keyword">for</span></span> (<span class="keyword"><span class="keyword">var</span></span> i = <span class="number"><span class="number">0</span></span>; i &lt; len; i++)
    {
        <span class="keyword"><span class="keyword">if</span></span> (i <span class="keyword"><span class="keyword">in</span></span> <span class="keyword"><span class="keyword">this</span></span> &amp;&amp; fun.call(thisp, <span class="keyword"><span class="keyword">this</span></span>[i], i, <span class="keyword"><span class="keyword">this</span></span>))
        <span class="keyword"><span class="keyword">return</span></span> <span class="literal"><span class="literal">true</span></span>;
    }
    
    <span class="keyword"><span class="keyword">return</span></span> <span class="literal"><span class="literal">false</span></span>;
};
</code></pre>

<h2><code>map()</code>方法</h2>

<p><code>map()</code>方法返回一个由原数组中的每个元素调用一个指定函数<code>callbackfn</code>后的返回值组成的新数组。如果符合<code>callbackfn</code>会返回符合条件的一个值，将所有返回的值再创建一个新数组。</p>

<h3>语法</h3>

<pre class="cpp"><code class="cpp"><span class="built_in"><span class="built_in">array</span></span>.<span class="built_in"><span class="built_in">map</span></span>(callbackfn[, thisArg])
</code></pre>

<p><code>map()</code>方法会给原数组中的每个元素都按顺序调用一次 <code>callbackfn</code> 函数。<code>callbackfn</code>每次执行后的返回值组合起来形成一个新数组。 <code>callbackfn</code> 函数只会在有值的索引上被调用；那些从来没被赋过值或者使用 <code>delete</code> 删除的索引则不会被调用。</p>

<h3>示例</h3>

<p>使用<code>map()</code>方法遍历数组<code>peoples</code>，并且让<code>index</code>在以前的<code>index</code>增加<code>1</code>:</p>

<p>var usersDb = peoples.map(function (user, index) {<br>
    user.id = index + 1;
    return user;
});
console.table(usersDb);</p>

<p>Chrome浏览器输出的结果：</p>

<p><img src="/sites/default/files/blogs/2016/1603/array-map.png" alt="map()方法" title="map()方法"></p>

<h3>内部实现</h3>

<pre class="javascript"><code class="javascript">Array.prototype.map = <span class="keyword"><span class="keyword">function</span></span>(fun <span class="comment"><span class="comment">/*, thisp*/</span></span>) {
    <span class="keyword"><span class="keyword">var</span></span> len = <span class="keyword"><span class="keyword">this</span></span>.length;
    <span class="keyword"><span class="keyword">if</span></span> (<span class="keyword"><span class="keyword">typeof</span></span> fun != <span class="string"><span class="string">"function"</span></span>)
        <span class="keyword"><span class="keyword">throw</span></span> <span class="keyword"><span class="keyword">new</span></span> TypeError();

    <span class="keyword"><span class="keyword">var</span></span> res = <span class="keyword"><span class="keyword">new</span></span> Array(len);
    <span class="keyword"><span class="keyword">var</span></span> thisp = arguments[<span class="number"><span class="number">1</span></span>];
    <span class="keyword"><span class="keyword">for</span></span> (<span class="keyword"><span class="keyword">var</span></span> i = <span class="number"><span class="number">0</span></span>; i &lt; len; i++)
    {
        <span class="keyword"><span class="keyword">if</span></span> (i <span class="keyword"><span class="keyword">in</span></span> <span class="keyword"><span class="keyword">this</span></span>)
        res[i] = fun.call(thisp, <span class="keyword"><span class="keyword">this</span></span>[i], i, <span class="keyword"><span class="keyword">this</span></span>);
    }
    
    <span class="keyword"><span class="keyword">return</span></span> res;
};
</code></pre>

<h2><code>filter()</code>方法</h2>

<p><code>filter()</code> 方法使用指定的函数<code>callbackfn</code>测试所有元素，并创建一个包含所有通过测试的元素的新数组。</p>

<h3>语法</h3>

<pre class="css"><code class="css"><span class="tag"><span class="tag">array</span></span><span class="class"><span class="class">.filter</span></span>(<span class="tag"><span class="tag">callbackfn</span></span><span class="attr_selector"><span class="attr_selector">[, thisArg]</span></span>)
</code></pre>

<p><code>filter()</code> 为数组中的每个元素调用一次 <code>callbackfn</code> 函数，并利用所有使得 <code>callbackfn</code> 返回 <code>true</code> 或 等价于 <code>true</code> 的值 的元素创建一个新数组。<code>callbackfn</code> 只会在已经赋值的索引上被调用，对于那些已经被删除或者从未被赋值的索引不会被调用。那些没有通过 <code>callbackfn</code> 测试的元素会被跳过，不会被包含在新数组中。</p>

<h3>示例</h3>

<p>遍历出数组中<code>gender</code>为<code>M</code>的相关数组项：</p>

<pre class="javascript"><code class="javascript"><span class="keyword"><span class="keyword">var</span></span> guys = peoples.filter(<span class="function"><span class="keyword"><span class="function"><span class="keyword">function</span></span></span><span class="function"> <span class="params"><span class="params">(user)</span></span> {</span></span>  
    <span class="keyword"><span class="keyword">return</span></span> user.gender === <span class="string"><span class="string">'M'</span></span>;
});
console.table(guys);  
</code></pre>

<p>Chrome浏览器输出的结果：</p>

<p><img src="/sites/default/files/blogs/2016/1603/array-filter.png" alt="filter()方法" title="filter()方法"></p>

<h3>内部实现</h3>

<pre class="javascript"><code class="javascript">Array.prototype.filter = <span class="keyword"><span class="keyword">function</span></span>(fun <span class="comment"><span class="comment">/*, thisp*/</span></span>) {
    <span class="keyword"><span class="keyword">var</span></span> len = <span class="keyword"><span class="keyword">this</span></span>.length;
    <span class="keyword"><span class="keyword">if</span></span> (<span class="keyword"><span class="keyword">typeof</span></span> fun != <span class="string"><span class="string">"function"</span></span>)
        <span class="keyword"><span class="keyword">throw</span></span> <span class="keyword"><span class="keyword">new</span></span> TypeError();

    <span class="keyword"><span class="keyword">var</span></span> res = <span class="keyword"><span class="keyword">new</span></span> Array();
    <span class="keyword"><span class="keyword">var</span></span> thisp = arguments[<span class="number"><span class="number">1</span></span>];
    <span class="keyword"><span class="keyword">for</span></span> (<span class="keyword"><span class="keyword">var</span></span> i = <span class="number"><span class="number">0</span></span>; i &lt; len; i++)
    {
        <span class="keyword"><span class="keyword">if</span></span> (i <span class="keyword"><span class="keyword">in</span></span> <span class="keyword"><span class="keyword">this</span></span>)
        {
        <span class="keyword"><span class="keyword">var</span></span> val = <span class="keyword"><span class="keyword">this</span></span>[i]; <span class="comment"><span class="comment">// in case fun mutates this</span></span>
        <span class="keyword"><span class="keyword">if</span></span> (fun.call(thisp, val, i, <span class="keyword"><span class="keyword">this</span></span>))
            res.push(val);
        }
    }
    
    <span class="keyword"><span class="keyword">return</span></span> res;
};
</code></pre>

<h2>总结</h2>

<p>今天主要学习了数组的五个遍历方法：<code>forEach()</code>、<code>every()</code>、<code>some()</code>、<code>map()</code>和<code>filter()</code>。其中<code>forEach()</code>、<code>every()</code>和<code>some()</code>方法不会改变原数组，而<code>map()</code>和<code>filter()</code>方法会根据指定的函数<code>callbackfn</code>创建一个新数组。其中<code>filter()</code>方法将符合<code>callbackfn</code>函数条件创建一个新数组，而<code>some()</code>将数组的每一项都是在原数组中的对应项上运行传入的函数<code>callbackfn</code>。另外，<code>every()</code>和<code>some()</code>方法根据指定的函数<code>callbackfn</code>返回<code>true</code>或<code>false</code>值，其中<code>every()</code>方法，只要有一项不符合<code>callbackfn</code>指定的条件就会返回<code>false</code>，<code>some()</code>方法，将根据<code>callbackfn</code>函数指定的条件，只要符合就返回<code>true</code>，不符合则返回则返回<code>false</code>。</p>


<p>原链接：<a href="http://www.w3cplus.com/javascript/array-part-7.html" target="_blank">http://www.w3cplus.com/javascript/array-part-7.html</a></p>
</div>
